USE Ingest;

CREATE MATERIALIZED VIEW SOPLINEJOIN
DISTRIBUTED BY HASH(SOPTYPE, SOPNUMBE, LNITMSEQ, CMPNTSEQ)
REFRESH ASYNC
AS
SELECT    
          SOPTYPE,
          SOPNUMBE,
          LNITMSEQ,
          CMPNTSEQ,
          ITEMNMBR,
          ITEMDESC,
          NONINVEN,
          DROPSHIP,
          UOFM,
          LOCNCODE,
          UNITCOST,
          ORUNTCST,
          UNITPRCE,
          ORUNTPRC,
          XTNDPRCE,
          OXTNDPRC,
          REMPRICE,
          OREPRICE,
          EXTDCOST,
          OREXTCST,
          MRKDNAMT,
          ORMRKDAM,
          MRKDNPCT,
          MRKDNTYP,
          INVINDX,
          CSLSINDX,
          SLSINDX,
          MKDNINDX,
          RTNSINDX,
          INUSINDX,
          INSRINDX,
          DMGDINDX,
          ITMTSHID,
          IVITMTXB,
          BKTSLSAM,
          ORBKTSLS,
          TAXAMNT,
          ORTAXAMT,
          TXBTXAMT,
          OTAXTAMT,
          BSIVCTTL,
          TRDISAMT,
          ORTDISAM,
          DISCSALE,
          ORDAVSLS,
          QUANTITY,
          ATYALLOC,
          QTYINSVC,
          QTYINUSE,
          QTYDMGED,
          QTYRTRND,
          QTYONHND,
          QTYCANCE,
          QTYCANOT,
          QTYORDER,
          QTYPRBAC,
          QTYPRBOO,
          QTYPRINV,
          QTYPRORD,
          QTYPRVRECVD,
          QTYRECVD,
          QTYREMAI,
          QTYREMBO,
          QTYTBAOR,
          QTYTOINV,
          QTYTORDR,
          QTYFULFI,
          QTYSLCTD,
          QTYBSUOM,
          EXTQTYAL,
          EXTQTYSEL,
          ReqShipDate,
          FUFILDAT,
          ACTLSHIP,
          SHIPMTHD,
          SALSTERR,
          SLPRSNID,
          PRCLEVEL,
          COMMNTID,
          BRKFLD1,
          BRKFLD2,
          BRKFLD3,
          CURRNIDX,
          TRXSORCE,
          SOPLNERR,
          ORGSEQNM,
          ITEMCODE,
          PURCHSTAT,
          DECPLQTY,
          DECPLCUR,
          ODECPLCU,
          EXCEPTIONALDEMAND,
          TAXSCHID,
          TXSCHSRC,
          PRSTADCD,
          ShipToName,
          CITY,
          STATE,
          ZIPCODE,
          CCode,
          COUNTRY,
          Flags,
          CONTNBR,
          CONTLNSEQNBR,
          CONTSTARTDTE,
          CONTENDDTE,
          CONTITEMNBR,
          CONTSERIALNBR,
          ISLINEINTRA,
          Print_Phone_NumberGB,
          DEX_ROW_TS,
          DEX_ROW_ID
   FROM SOP10200 AS a 
   WHERE
   NOT EXISTS
       (SELECT 1
        FROM SOP30300
        WHERE SOPTYPE = a.SOPTYPE
          AND SOPNUMBE = a.SOPNUMBE
          AND LNITMSEQ = a.LNITMSEQ
          AND CMPNTSEQ = a.CMPNTSEQ )

   UNION SELECT 
                SOPTYPE,
                SOPNUMBE,
                LNITMSEQ,
                CMPNTSEQ,
                ITEMNMBR,
                ITEMDESC,
                NONINVEN,
                DROPSHIP,
                UOFM,
                LOCNCODE,
                UNITCOST,
                ORUNTCST,
                UNITPRCE,
                ORUNTPRC,
                XTNDPRCE,
                OXTNDPRC,
                REMPRICE,
                OREPRICE,
                EXTDCOST,
                OREXTCST,
                MRKDNAMT,
                ORMRKDAM,
                MRKDNPCT,
                MRKDNTYP,
                INVINDX,
                CSLSINDX,
                SLSINDX,
                MKDNINDX,
                RTNSINDX,
                INUSINDX,
                INSRINDX,
                DMGDINDX,
                ITMTSHID,
                IVITMTXB,
                BKTSLSAM,
                ORBKTSLS,
                TAXAMNT,
                ORTAXAMT,
                TXBTXAMT,
                OTAXTAMT,
                BSIVCTTL,
                TRDISAMT,
                ORTDISAM,
                DISCSALE,
                ORDAVSLS,
                QUANTITY,
                ATYALLOC,
                QTYINSVC,
                QTYINUSE,
                QTYDMGED,
                QTYRTRND,
                QTYONHND,
                QTYCANCE,
                QTYCANOT,
                QTYORDER,
                QTYPRBAC,
                QTYPRBOO,
                QTYPRINV,
                QTYPRORD,
                QTYPRVRECVD,
                QTYRECVD,
                QTYREMAI,
                QTYREMBO,
                QTYTBAOR,
                QTYTOINV,
                QTYTORDR,
                QTYFULFI,
                QTYSLCTD,
                QTYBSUOM,
                EXTQTYAL,
                EXTQTYSEL,
                ReqShipDate,
                FUFILDAT,
                ACTLSHIP,
                SHIPMTHD,
                SALSTERR,
                SLPRSNID,
                PRCLEVEL,
                COMMNTID,
                BRKFLD1,
                BRKFLD2,
                BRKFLD3,
                CURRNIDX,
                TRXSORCE,
                SOPLNERR,
                ORGSEQNM,
                ITEMCODE,
                PURCHSTAT,
                DECPLQTY,
                DECPLCUR,
                ODECPLCU,
                EXCEPTIONALDEMAND,
                TAXSCHID,
                TXSCHSRC,
                PRSTADCD,
                ShipToName,
                CITY,
                STATE,
                ZIPCODE,
                CCode,
                COUNTRY,
                Flags,
                CONTNBR,
                CONTLNSEQNBR,
                CONTSTARTDTE,
                CONTENDDTE,
                CONTITEMNBR,
                CONTSERIALNBR,
                ISLINEINTRA,
                Print_Phone_NumberGB,
                DEX_ROW_TS,
                DEX_ROW_ID
   FROM SOP30300