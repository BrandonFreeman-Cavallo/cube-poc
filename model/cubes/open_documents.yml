cubes:
- name: open_documents
  sql_table: dbo.SOP10100
  data_source: default

  joins: []

  dimensions:
  - name: external_id
    sql: "CONCAT(TRIM({document_class}), '|', TRIM(SOPNUMBE))"
    type: string

  - name: external_number
    sql: SOPNUMBE
    type: string

  # - name: version
  #   sql:
  #   type: string

  - name: master_number
    sql: MSTRNUMB
    type: string

  # - name: company
  #   sql:
  #   type: string

  - name: document_type
    sql: SOPTYPE
    type: number

  - name: payment_terms_id
    sql: PYMTRMID
    type: string

  - name: price_level_id
    sql: PRCLEVEL
    type: string

  - name: warehouse_id
    sql: LOCNCODE
    type: string

  - name: sales_territory_id
    sql: SALSTERR
    type: string

  - name: document_class
    type: string
    case:
      when:
      - sql: "SOPTYPE = 1"
        label: QUOTE
      - sql: "SOPTYPE = 2"
        label: ORDER
      - sql: "SOPTYPE = 3"
        label: INVOICE
      - sql: "SOPTYPE = 4"
        label: RETURN
      - sql: "SOPTYPE = 5"
        label: BACK_ORDER
      - sql: "SOPTYPE = 6"
        label: FULFILLMENT_ORDER

  - name: original_external_id
    type: string
    case:
      when:
      - sql: "LEN({orig_document_class}) > 0 AND LEN(ORIGNUMB) > 0"
        label:
          sql: "CONCAT({orig_document_class}, '|', ORIGNUMB)"

  - name: orig_document_class
    type: string
    case:
      when:
      - sql: "ORIGTYPE = 1"
        label: QUOTE
      - sql: "ORIGTYPE = 2"
        label: ORDER
      - sql: "ORIGTYPE = 3"
        label: INVOICE
      - sql: "ORIGTYPE = 4"
        label: RETURN
      - sql: "ORIGTYPE = 5"
        label: BACK_ORDER
      - sql: "ORIGTYPE = 6"
        label: FULFILLMENT_ORDER

  - name: orig_document_num
    sql: ORIGNUMB
    type: string

  - name: subtotal
    sql: SUBTOTAL
    type: number

  - name: discount
    type: number
    case:
      when:
      - sql: "TRDISPCT > 0"
        label:
          sql: "(TRDISPCT / 100) * SUBTOTAL"
      - sql: "TRDISAMT > 0"
        label:
          sql: TRDISAMT

  - name: subtotal_net_discount
    sql: "SUBTOTAL - {discount}"
    type: number

  - name: tax
    sql: TAXAMNT
    type: number

  - name: freight_taxable
    type: string
    case:
      when:
      - sql: "FRGTTXBL = 1"
        label: TAXABLE
      - sql: "FRGTTXBL = 2"
        label: NONTAXABLE
      - sql: "FRGTTXBL = 3"
        label: BASE_ON_CUSTOMERS

  - name: freight
    sql: FRTAMNT
    type: number

  - name: freight_tax_amount
    sql: FRTTXAMT
    type: number

  - name: total
    sql: DOCAMNT
    type: number

  - name: markdown_amount
    sql: MRKDNAMT
    type: number

  - name: remaining_subtotal
    sql: REMSUBTO
    type: number

  - name: misc_amount
    sql: MISCAMNT
    type: number

  - name: tax_schedule_id
    sql: TAXSCHID
    type: number

  - name: is_sli_tax_based_on_invoice_total
    sql: BSIVCTTL
    type: boolean

  - name: taxable_tax_amount
    sql: TXBTXAMT
    type: number

  - name: payment_amount_received
    sql: PYMTRCVD
    type: number

  - name: deposit_amount_received
    sql: DEPRECVD
    type: number

  - name: account_amount
    sql: ACCTAMNT
    type: number

  - name: transaction_source
    sql: TRXSORCE
    type: string

  # - name: current_queue_id
  #   sql: [computed: BACHNUMB, DOCID]	
  #   type: string

  # - name: is_posted
  #   sql: "NOW() > GLPOSTDT"
  #   type: boolean

  - name: is_void
    type: boolean
    case:
      when:
      - sql: "VOIDSTTS = 1 OR VOIDSTTS = 2"
        label: "true"
      else:
        label: "false"

  - name: gl_posting_date
    sql: GLPOSTDT
    type: time

  - name: quote_date
    sql: QUOTEDAT
    type: time

  - name: quote_expiration_date
    sql: QUOEXPDA
    type: time

  - name: order_date
    sql: ORDRDATE
    type: time

  - name: invoice_date
    sql: INVODATE
    type: time

  - name: back_order_date
    sql: BACKDATE
    type: time

  - name: return_date
    sql: RETUDATE
    type: time

  - name: requested_ship_date
    sql: ReqShipDate
    type: time

  - name: fulfillment_date
    sql: FUFILDAT
    type: time

  - name: discount_date
    sql: DISCDATE
    type: time

  - name: due_date
    sql: DUEDATE
    type: time

  - name: posted_date
    sql: POSTEDDT
    type: time

  - name: tax_date
    sql: Tax_Date
    type: time

  - name: sale_date
    sql: SALEDATE
    type: time

  - name: created_at
    sql: CREATDDT
    type: time

  - name: doc_date
    sql: DOCDATE
    type: time

  # - name: last_modified_at
  #   sql:
  #   type: time

  # - name: last_processed_at
  #   sql: "GETUTCDATE()"
  #   type: time

  - name: shipping_method_id
    sql: SHIPMTHD
    type: string

  - name: shipping_city
    sql: CITY
    type: string

  - name: shipping_state
    sql: STATE
    type: string

  - name: shipping_zip
    sql: ZIPCODE
    type: string

  - name: shipping_country
    sql: COUNTRY
    type: string

  - name: shipping_country_code
    sql: CCode
    type: string

  - name: freight_tax_schedule_id
    sql: FRTSCHID
    type: string

  - name: ups_zone
    sql: UPSZONE
    type: string

  - name: is_ship_complete
    sql: SHIPCOMPLETE
    type: boolean

  - name: extended_cost
    sql: ExtendedCost
    type: number

  - name: margin_percent
    sql: 100 * ({subtotal_net_discount} - {extended_cost}) / {subtotal_net_discount})
    type: number

  - name: margin_dollars
    sql: subtotal_net_discount - extended_cost
    type: number

  - name: sales_rep_id
    sql: SLPRSNID
    type: string

  - name: sales_rep_name
    sql: SLPRSNID
    type: string

  - name: customer_number
    sql: CUSTNMBR
    type: string

  - name: customer_name
    sql: CUSTNAME
    type: string

  - name: shipped_at
    sql: ACTLSHIP
    type: time

  # - name: historical_at
  #   sql: "CAST('1900-01-01' AS DATETIME )"
  #   type: time

  measures:

  pre_aggregations:
# Pre-aggregation definitions go here.
# Learn more in the documentation: https://cube.dev/docs/caching/pre-aggregations/getting-started

